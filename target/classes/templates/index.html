<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>文件管理器</title>

    <link href="https://cdn.bootcss.com/element-ui/2.3.7/theme-chalk/index.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>
    <script src="https://cdn.bootcss.com/vue-resource/1.5.0/vue-resource.min.js"></script>
    <script src="https://cdn.bootcss.com/element-ui/2.3.7/index.js"></script>
</head>
<style>
    #app {
        width: 75%;
        margin: auto;
        margin-top: 3%;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }

    #content td {
        padding-top: 6px;
        padding-bottom: 6px;
    }
</style>
<body>
<div id="app">
    <div id="content">
        <el-table
                :data="files"
                stripe
                border
                :default-sort="{prop: 'name'}"
                style="width: 100%">
            <el-table-column
                    sortable
                    prop="name"
                    label="名称">
                <template slot-scope="scope">
                    <div>
                        <svg v-if="scope.row.directory"
                             class="icon"
                             style="width: 1em; height: 1em;vertical-align: middle;fill:
                            currentColor;overflow: hidden;"
                             viewBox="0 0 1024 1024" version="1.1"
                             xmlns="http://www.w3.org/2000/svg" p-id="1053">
                            <path d="M904 875.9H120c-30.9 0-56-25.1-56-56V204.1c0-30.9 25.1-56 56-56h231.6c12.8 0 25.2 4.4 35.2 12.4L509.9 260H904c30.9 0 56 25.1 56 56v503.8c0 31-25.1 56.1-56 56.1z m0-56v28-28zM351.6 204.1H120v615.8h784l0.1-503.8H510c-12.8 0-25.3-4.4-35.3-12.5l-123.1-99.5z"
                                  p-id="1054"></path>
                        </svg>
                        <svg v-else
                             class="icon"
                             style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;"
                             viewBox="0 0 1024 1024" version="1.1"
                             xmlns="http://www.w3.org/2000/svg" p-id="591">
                            <path d="M751.3 957.4H274.7c-82.7 0-150-67.3-150-150V216.2c0-82.7 67.3-150 150-150h138.9c13.8 0 25 11.2 25 25s-11.2 25-25 25H274.7c-55.1 0-100 44.9-100 100v591.2c0 55.1 44.9 100 100 100h476.6c55.1 0 100-44.9 100-100v-390H653.6c-32.4 0-62.8-12.6-85.7-35.6-22.9-23-35.4-53.5-35.2-85.9l0.9-204.9c0-10 6-19 15.2-22.9 9.2-3.9 19.8-2 27 4.8l317.7 301.2 0.3 0.3 0.5 0.5c4.3 4.5 6.9 10.6 6.9 17.2v415c0.1 83-67.2 150.3-149.9 150.3z m-168-808.3l-0.6 147.1c-0.1 19 7.3 36.9 20.7 50.4 13.4 13.5 31.3 20.9 50.3 20.9h160L583.3 149.1zM701.4 598H324.6c-13.8 0-25-11.2-25-25s11.2-25 25-25h376.8c13.8 0 25 11.2 25 25s-11.2 25-25 25zM701.4 747.3H324.6c-13.8 0-25-11.2-25-25s11.2-25 25-25h376.8c13.8 0 25 11.2 25 25s-11.2 25-25 25z"
                                  p-id="592"></path>
                        </svg>
                        <a :href="'?dir='+scope.row.path"
                           v-if="scope.row.directory">
                            <span>{{scope.row.name}}</span>
                        </a>
                        <span v-else>{{scope.row.name}}</span>
                    </div>
                </template>
            </el-table-column>
            <el-table-column
                    sortable
                    sort-by="lastModified"
                    prop="formatLastModified"
                    label="修改日期"
                    width="170">
            </el-table-column>
            <el-table-column
                    sortable
                    sort-by="size"
                    prop="formatSize"
                    label="大小"
                    align="right"
                    width="100">
            </el-table-column>
            <el-table-column
                    label="操作"
                    align="center"
                    width="200">
                <template slot-scope="scope">
                    <el-button size="mini" type="button" @click="onClickCopy">复制路径</el-button>
                    <el-button size="mini" type="button" @click="onClickDownload(scope.row.path)">
                        导出
                    </el-button>
                </template>
            </el-table-column>
        </el-table>
    </div>
</div>

<script th:inline="javascript">
    new Vue({
        el: '#app',
        data: {
            currentSavePath: "",
            currentPath: "",
            files: []
        },
        mounted: function () {
            var files = new Array()
            files.push({
                path: [[${parentPath}]],
                name: "...",
                directory: true,
            })
            files.push.apply(files,[[${files}]])
            Vue.set(this, "files", files)
        },
        methods: {
            sortByName(a, b) {

            },
            onClickCopy(tab) {

            },
            onClickDownload(pullPath) {
                this.$prompt('输入导出路径', '导出', {
                    inputValue: this.currentSavePath,
                    inputPattern: /\S/,
                    inputErrorMessage: '请输入导出路径',
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                }).then(({value}) => {
                    if (value != '' && value != null) {
                        this.currentSavePath = value
                        this.requestPullRemoteFile(pullPath)
                    }

                }).catch(() => {
                    console.log("cancel")
                });
            },
            requestPullRemoteFile(pullPath) {
                this.$http.post("api/pull", {
                    pullPath: pullPath,
                    savePath: this.currentSavePath
                }, {emulateJSON: true})
                    .then(function (response) {
                        console.log(response.body)
                        if (response.body) {
                            this.$message({
                                message: '导出成功',
                                type: 'success'
                            });
                        }
                    })
                    .catch(function (response) {
                        console.log(response)
                    });
            }
        }
    })

</script>
</body>
</html>